# Kafkaäº‹åŠ¡ä¸€èˆ¬åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨å‘¢

## 1. Kafkaäº‹åŠ¡

### 1.1 Kafkaäº‹åŠ¡æ˜¯ä»€ä¹ˆ

> ***é¢è¯•å®˜ï¼šKafkaäº‹åŠ¡ä½ è¯´è¯´çœ‹ï¼Ÿ***

Kafkaçš„äº‹åŠ¡ä¸»è¦åº”ç”¨åœ¨ä»¥æµå¼å¤„ç†çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæµå¼å¤„ç†ï¼Ÿå¬èµ·æ¥éƒ½è§‰å¾—å¾ˆè¿·ç³Šä¸çŸ¥é“æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚

Kafkaäº‹åŠ¡æ”¯æŒçš„æµå¼å¤„ç†è¿‡ç¨‹ä¸€èˆ¬æ˜¯è¿™æ ·ï¼ŒAç¨‹åºä»ä¸€ä¸ªAä¸»é¢˜æ¶ˆè´¹Aæ¶ˆæ¯ï¼Œå¯¹Aæ¶ˆæ¯è¿›è¡Œå¤„ç†åï¼Œå†æŠŠç»“æœå†™å…¥åˆ°Bä¸»é¢˜ï¼Œåç»­Bç¨‹åºä¼šå¯¹Bä¸»é¢˜çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚ä¹Ÿå°±æ˜¯`æ¶ˆè´¹ - å¤„ç† - ç”Ÿäº§`çš„è¿‡ç¨‹ã€‚

è¿™æ ·çš„ä¸€ä¸ªè¿‡ç¨‹æ¶‰åŠäº†ä¸¤ä¸ªæ¶ˆæ¯çš„æ¶ˆè´¹ã€ä¸€ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§ï¼Œå¦‚ä½•ä¿è¯è¿™æ•´ä¸ªè¿‡ç¨‹çš„äº‹åŠ¡æ€§ï¼Œè®©è¿™æ•´ä¸ªè¿‡ç¨‹è¦ä¹ˆæˆåŠŸã€è¦ä¹ˆéƒ½ä¸æˆåŠŸï¼Œè¿™å°±æ˜¯Kafkaäº‹åŠ¡è¦åšçš„äº‹æƒ…ã€‚

å—å“¥ç”»ä¸‹æµç¨‹å›¾ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ç†è§£ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/fc55151379244961a3af129d5ea03574.png#pic_center)

### 1.2 é‡å¤æ¶ˆè´¹é—®é¢˜

> ***é¢è¯•å®˜ï¼šä½ è¯´çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œä¸ä½¿ç”¨äº‹åŠ¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ***

æµå¼å¤„ç†ç¨‹åºçš„`æ¶ˆè´¹ - å¤„ç† - ç”Ÿäº§`è¿‡ç¨‹ï¼Œå¦‚æœæ²¡æœ‰äº‹åŠ¡çš„ä¿è¯ï¼Œå¯èƒ½ä¼šå‡ºç°å¤šç§æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œè¿™å°±ä¼šäº§ç”Ÿå„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜äº†ã€‚

ç‰¹åˆ«æ˜¯åœ¨é‡‘èã€æ”¯ä»˜è¡Œä¸šï¼Œæ•´ä¸ªæ”¯ä»˜è¿‡ç¨‹æ¶‰åŠäº†å¤šä¸ªæµç¨‹ï¼Œä¾‹å¦‚ç”¨æˆ·ä¸‹å• -> åº“å­˜æ ¡éªŒ -> è®¢å•å¤„ç†-> å®é™…æ‰£è´¹ -> æ¸…ç®—ç»“ç®—ï¼Œè¿™äº›ä¸šåŠ¡åœºæ™¯é‡‡ç”¨çš„ä¾¿æ˜¯æµå¼å¤„ç†ç¨‹åºã€‚æ¶‰åŠèµ„é‡‘çš„ä¸šåŠ¡åœºæ™¯ï¼Œäº‹åŠ¡çš„ä¿éšœå°±æ›´é‡è¦äº†ï¼ï¼

æˆ‘è¯´è¯´ä¸¤ä¸ªæ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„åœºæ™¯ã€‚

è¿˜æ˜¯ä¸¾ä¾‹ä¸Šæ–‡çš„åœºæ™¯ï¼šAç¨‹åºä»ä¸€ä¸ªAä¸»é¢˜æ¶ˆè´¹Aæ¶ˆæ¯ï¼Œå¯¹Aæ¶ˆæ¯è¿›è¡Œå¤„ç†åï¼Œå†æŠŠç»“æœå†™å…¥åˆ°Bä¸»é¢˜ï¼Œåç»­Bç¨‹åºä¼šå¯¹Bä¸»é¢˜çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚

ï¼ˆ1ï¼‰ç¨‹åºå´©æºƒé€ æˆçš„é‡å¤æ¶ˆè´¹

å¦‚æœAç¨‹åºå¯¹Aæ¶ˆæ¯è¿›è¡Œå¤„ç†åï¼ŒæŠŠç»“æœå†™å…¥åˆ°Bä¸»é¢˜ã€‚ä½†**åœ¨åç§»é‡æäº¤**çš„æ—¶å€™å´©æºƒäº†ï¼Œæ­¤æ—¶Kafkaä¼šè®¤ä¸ºAæ¶ˆæ¯è¿˜æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œè€ŒAç¨‹åºå´©æºƒäº†Kafkaä¼šæŠŠè¯¥åˆ†åŒºåˆ†é…ç»™æ–°çš„æ¶ˆè´¹è€…ã€‚

é—®é¢˜å°±æ¥äº†ï¼Œæ–°çš„æ¶ˆè´¹è€…ä¼šé‡æ–°æ¶ˆè´¹Aæ¶ˆæ¯ï¼Œç­‰äºBä¸»é¢˜è¢«å†™å…¥äº†ä¸¤æ¡ç›¸åŒçš„æ¶ˆæ¯ï¼ŒAæ¶ˆæ¯è¢«æ¶ˆè´¹äº†ä¸¤æ¬¡ã€‚

ï¼ˆ2ï¼‰åƒµå°¸ç¨‹åºé€ æˆçš„é‡å¤æ¶ˆè´¹

å¦‚æœä¸€ä¸ªæ¶ˆè´¹è€…ç¨‹åºè®¤ä¸ºè‡ªå·±æ²¡æœ‰æ­»äº¡ï¼Œä½†å› ä¸ºåœæ­¢å‘Kafkaå‘é€å¿ƒè·³ä¸€æ®µæ—¶é—´åï¼ŒKafkaè®¤ä¸ºå®ƒå·²ç»æ­»äº¡äº†ï¼Œè¿™ç§ç¨‹åºå«åšåƒµå°¸ç¨‹åºã€‚

Aç¨‹åºä»Kafkaè¯»å–Aæ¶ˆæ¯åï¼Œå®ƒæš‚æ—¶æŒ‚èµ·äº†ï¼Œå¤±å»å’ŒKafkaçš„è¿æ¥ä¹Ÿä¸èƒ½æäº¤åç§»é‡ã€‚æ­¤æ—¶Kafkaè®¤ä¸ºå…¶æ­»äº¡äº†ï¼Œä¼šæŠŠAæ¶ˆè´¹åˆ†é…ç»™æ–°çš„æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚

ä½†åç»­Aç¨‹åºæ¢å¤åï¼Œä¼šç»§ç»­æŠŠAæ¶ˆæ¯å†™å…¥Bä¸»é¢˜ï¼Œä»ç„¶é€ æˆäº†Aæ¶ˆè´¹è¢«æ¶ˆè´¹äº†ä¸¤æ¬¡ã€‚

**å¯èƒ½å¾ˆå¤šäººä¼šè¯´**ï¼Œè¿™ä¸ªæµç¨‹æœ‰é‡å¤æ¶ˆè´¹çš„é—®é¢˜ï¼Œé‚£å¤„ç†é‡å¤æ¶ˆè´¹çš„é—®é¢˜ä¸å°±å¯ä»¥äº†ï¼Œä¸å¿…å¼•å…¥Kafkaäº‹åŠ¡è¿™ä¹ˆå¤æ‚ã€‚ä½†åœ¨é‡‘èã€æ”¯ä»˜è¿™ä¹ˆä¸¥è°¨ã€é‡è¦çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬è¦çš„æ˜¯æ•´ä¸ªæµç¨‹å“ªæ€•æœ‰ä¸€ä¸ç‚¹å‡ºé”™ï¼Œæ•´ä¸ªå¤„ç†æµç¨‹å…¨éƒ½è¦è¿›è¡Œå›æ»šã€‚

### 1.3 Kafkaäº‹åŠ¡ä¸èƒ½å¤„ç†çš„é—®é¢˜

> ***é¢è¯•å®˜ï¼šKafkaäº‹åŠ¡æœ‰ä¸èƒ½å¤„ç†çš„é—®é¢˜å—ï¼Ÿ***

å½“ç„¶åœ¨æ•´ä¸ªKafkaäº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰æŸäº›æ“ä½œæ˜¯ä¸èƒ½å›æ»šçš„ï¼ŒKafkaäº‹åŠ¡å¹¶ä¸æ”¯æŒå¤„ç†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ã€‚

ï¼ˆ1ï¼‰Kafkaäº‹åŠ¡è¿‡ç¨‹åŠ å…¥å¤–éƒ¨é€»è¾‘

ä¾‹å¦‚Aç¨‹åºæ¶ˆè´¹æ¶ˆæ¯Açš„è¿‡ç¨‹ä¸­ï¼Œå‘é€äº†ä¸€ä¸ªé€šçŸ¥é‚®ä»¶ï¼Œé‚£æ•´ä¸ªå¤–éƒ¨æ“ä½œæ˜¯ä¸å¯é€†çš„ï¼Œä¸åœ¨äº‹åŠ¡çš„å¤„ç†èŒƒå›´å†…ã€‚

ï¼ˆ2ï¼‰è¯»å–Kafkaæ¶ˆæ¯åå†™å…¥æ•°æ®åº“

è¿™å…¶å®ä¹Ÿå¯ä»¥å½“æˆä¸€ä¸ªå¤–éƒ¨å¤„ç†é€»è¾‘ï¼Œæ•°æ®åº“çš„äº‹åŠ¡å¹¶ä¸åœ¨Kafkaäº‹åŠ¡çš„å¤„ç†èŒƒå›´å†…ã€‚

### 1.4 SpringBootä½¿ç”¨Kafkaäº‹åŠ¡

> ***é¢è¯•å®˜ï¼šæ¥è§¦è¿‡SpringBootå‘é€Kafkaäº‹åŠ¡æ¶ˆæ¯å—ï¼Ÿ***

åœ¨SpringBooté¡¹ç›®æˆ‘ä»¬å¯ä»¥è½»æ¾ä½¿ç”¨Kafkaäº‹åŠ¡ï¼Œé€šè¿‡ä»¥ä¸‹Kafkaäº‹åŠ¡çš„æ”¯æŒï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿è¯**æ¶ˆæ¯çš„å‘é€å’Œåç§»é‡çš„æäº¤**å…·æœ‰äº‹åŠ¡æ€§ï¼Œä»è€Œé¿å…ä¸Šè¿°çš„é‡å¤æ¶ˆè´¹é—®é¢˜ã€‚

ï¼ˆ1ï¼‰å…ˆå¼•å…¥`spring-kafka`ä¾èµ–

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework.kafka</groupId>
        <artifactId>spring-kafka</artifactId>
        <version>xxx</version>
    </dependency>
</dependencies>
```

ï¼ˆ2ï¼‰é…ç½®Kafkaäº‹åŠ¡ç®¡ç†å™¨å’Œç”Ÿäº§è€…å·¥å‚

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Bean;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.kafka.core.ProducerFactory;
import org.springframework.kafka.transaction.KafkaTransactionManager;
import org.springframework.kafka.support.serializer.JsonSerializer;
import org.apache.kafka.common.serialization.StringSerializer;
import org.springframework.kafka.core.DefaultKafkaProducerFactory;

import java.util.HashMap;
import java.util.Map;

@Configuration
public class KafkaProducerConfig {

    @Bean
    public ProducerFactory<String, Object> producerFactory() {
        Map<String, Object> configProps = new HashMap<>();
        configProps.put(org.apache.kafka.clients.producer.ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        configProps.put(org.apache.kafka.clients.producer.ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        configProps.put(org.apache.kafka.clients.producer.ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, JsonSerializer.class);
        configProps.put(org.apache.kafka.clients.producer.ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);
        configProps.put(org.apache.kafka.clients.producer.ProducerConfig.TRANSACTIONAL_ID_CONFIG, "tx-");
        
        DefaultKafkaProducerFactory<String, Object> factory = new DefaultKafkaProducerFactory<>(configProps);
        factory.setTransactionIdPrefix("tran-");
        return factory;
    }

    @Bean
    public KafkaTransactionManager<String, Object> transactionManager(ProducerFactory<String, Object> producerFactory) {
        return new KafkaTransactionManager<>(producerFactory);
    }

    @Bean
    public KafkaTemplate<String, Object> kafkaTemplate(ProducerFactory<String, Object> producerFactory) {
        return new KafkaTemplate<>(producerFactory);
    }
}
```

ï¼ˆ3ï¼‰ä½¿ç”¨`KafkaTemplate`å‘é€äº‹åŠ¡æ€§æ¶ˆæ¯

```java
import org.springframework.kafka.annotation.EnableKafka;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@EnableKafka
@Service
public class KafkaConsumerService {

    @Autowired
    private KafkaTemplate<String, String> kafkaTemplate;

    @Transactional
    @KafkaListener(topics = "A")
    public void processMessage(String message) {
        // å¤„ç†ä»ä¸»é¢˜Aæ¥æ”¶åˆ°çš„æ¶ˆæ¯
        String processedMessage = "Processed " + message;
        // å°†å¤„ç†åçš„æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜B
        kafkaTemplate.send("B", processedMessage);
        // æäº¤äº‹åŠ¡ï¼Œç¡®ä¿æ¶ˆæ¯å‘é€å’Œåç§»é‡æäº¤ä¸€èµ·å®Œæˆ
    }
}
```
# æŒæ¡Kafkaé«˜æ°´ä½ï¼ŒKafkaå¦‚ä½•ä¿è¯æ¶ˆæ¯å¯é æ€§

## 1. Kafkaé«˜æ°´ä½

> ***é¢è¯•å®˜ï¼šçŸ¥é“Kafkaé«˜æ°´ä½å—ï¼Ÿ***

æˆ‘ä»¬éƒ½çŸ¥é“Kafkaæ¶ˆæ¯ä¿å­˜åœ¨é¦–é¢†åˆ†åŒºå’Œåˆ†åŒºå‰¯æœ¬ä¸­ï¼ŒKafkaè¦ä¿è¯å³ä½¿ä»åˆ†åŒºå‰¯æœ¬è¯»å–æ¶ˆæ¯ä¹Ÿåªä¼šè¯»å–**å·²æäº¤**çš„æ¶ˆæ¯ã€‚Kafkaçš„é«˜æ°´ä½å°±æ˜¯ä¸ºäº†**è¿™ä¸ªç›®æ ‡**è€Œå¼€å‘å‡ºæ¥çš„ã€‚

å¦‚æœå¤§å®¶å¯¹æ¶ˆæ¯å·²æäº¤çš„æ¦‚å¿µä¸æ¸…æ¥šçš„è¯ï¼Œå¯ä»¥çœ‹ä¸‹ä»¥ä¸‹çš„è§£é‡Šã€‚

> Kafkaçš„æ¶ˆæ¯åªæœ‰åœ¨**æ‰€æœ‰åˆ†åŒºå‰¯æœ¬**éƒ½åŒæ­¥è¯¥æ¶ˆæ¯åï¼Œæ‰ç®—æ˜¯**å·²æäº¤**çš„æ¶ˆæ¯

åœ¨åˆ†åŒºå¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œé¦–é¢†åˆ†åŒºä¼šåœ¨å‘é€çš„æ•°æ®é‡ŒåŠ å…¥å½“å‰é«˜æ°´ä½ã€‚å½“å‰é«˜æ°´ä½å°±æ˜¯å¤åˆ¶åç§»é‡ï¼Œè®°å½•äº†å½“å‰**å·²æäº¤æ¶ˆæ¯çš„æœ€å¤§åç§»é‡**ã€‚è€Œåˆ†åŒºå‰¯æœ¬å°±å¯ä»¥æ ¹æ®**é¦–é¢†åˆ†åŒºå‰¯æœ¬**æä¾›çš„é«˜æ°´ä½ï¼Œæ¥é¿å…**æœªæäº¤**çš„æ¶ˆæ¯è¢«æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚

å°±å¦‚ä¸‹å›¾ï¼Œ**æœ€å¤§åç§»é‡**çš„é™åˆ¶å°±åƒæµ·é¢ä¸Šçš„æ°´ä½ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/c72ee82cb79e466ebaa36518b780b4e5.png)


## 2. Kafkaæ¶ˆæ¯å¯é æ€§

### 2.1 æ¶ˆæ¯å­˜å‚¨å¯é æ€§

> ***é¢è¯•å®˜ï¼šä½ è¯´è¯´Kafkaæ˜¯æ€ä¹ˆä¿è¯æ¶ˆæ¯å¯é æ€§çš„ï¼Ÿ***

å¤§å®¶åœ¨å›ç­”é¢è¯•å®˜é—®é¢˜å‰å¯ä»¥æ€è€ƒä¸‹ï¼Œ**å¯é æ€§çš„å«ä¹‰**æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯çš„ä¸ä¸¢å¤±æ˜¯æœ€é‡è¦çš„ï¼Œæ•°æ®å³æ˜¯é‡‘é’±ã€‚å¦‚æœæŠŠå®¢æˆ·çš„ä¸€æ¡æ”¯ä»˜æ¶ˆæ¯ä¸¢å¤±ï¼Œè€Œè¿™æ¡æ”¯ä»˜ä¿¡æ¯çš„æ¶‰åŠçš„é‡‘é¢ä¸è²ï¼Œæƒ³æƒ³å¯¹å…¬å¸çš„æŸå¤±æœ‰å¤šå¤§ã€‚æ‰€ä»¥å¯é æ€§æ„å‘³ç€å¯¹æ¶ˆæ¯çš„å­˜å‚¨å’Œä¿æŠ¤ã€‚

Kafkaåœ¨è¿™æ–¹é¢é‡‡ç”¨äº†å¤åˆ¶æœºåˆ¶å’Œåˆ†åŒºå¤šå‰¯æœ¬æ¶æ„æ¥ä½œä¸ºæ¶ˆæ¯å¯é æ€§çš„æ ¸å¿ƒã€‚

ï¼ˆ1ï¼‰åˆ†åŒºå¤šå‰¯æœ¬æ¶æ„ã€‚

Kafkaçš„æ‰€æœ‰ä¸»é¢˜è¢«åˆ†ä¸ºäº†**å¤šä¸ªåˆ†åŒº**å­˜å‚¨åœ¨å¤šä¸ªBrokeré‡Œï¼Œè€Œæ¯ä¸ªåˆ†åŒºå¯ä»¥æœ‰**å¤šä¸ªå‰¯æœ¬**ã€‚ä¾‹å¦‚æœ‰4ä¸ªBrokerèŠ‚ç‚¹ï¼ŒBroker1å­˜å‚¨äº†åˆ†åŒºé¦–é¢†å‰¯æœ¬ï¼Œè€ŒBroker2ã€Broker3å¯ä»¥å­˜å‚¨å…¶åˆ†åŒºå‰¯æœ¬ã€‚

Kafkaå¯¹æ¶ˆæ¯çš„å­˜å‚¨æœ‰å¤šä¸ªåˆ†åŒºå‰¯æœ¬æ¥æ”¯æŒï¼Œå¯ä»¥é¿å…å•ç‚¹é—®é¢˜å¯¼è‡´æ•°æ®ä¸¢å¤±æ‰¾ä¸å›æ¥çš„æƒ…å†µã€‚

ï¼ˆ2ï¼‰å¤åˆ¶æœºåˆ¶ã€‚

åœ¨é€šå¸¸æƒ…å†µä¸‹æ¶ˆè´¹è€…éƒ½æ˜¯ä»**é¦–é¢†å‰¯æœ¬**é‡Œè¯»å–æ¶ˆæ¯ï¼ŒåŒæ—¶ä¼šæœ‰nï¼ˆ**å¤åˆ¶ç³»æ•°**ï¼‰ä¸ªBrokeræœºå™¨ä¼šå»**åŒæ­¥å¤åˆ¶**é¦–é¢†å‰¯æœ¬åï¼Œç”Ÿæˆ**è·Ÿéšè€…å‰¯æœ¬**ä¹Ÿå°±æ˜¯åˆ†åŒºå‰¯æœ¬ã€‚

å¦‚æœé¦–é¢†å‰¯æœ¬çš„æœºå™¨æŒ‚äº†ï¼Œåˆ†åŒºå‰¯æœ¬å°±ä¼šé€‰ä¸¾æˆä¸º**æ–°çš„é¦–é¢†å‰¯æœ¬**ã€‚

å¤åˆ¶æœºåˆ¶ä¿è¯äº†åˆ†åŒºå‰¯æœ¬å’Œé¦–é¢†å‰¯æœ¬çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰å¤åˆ¶æœºåˆ¶çš„åŠ æŒï¼Œåˆ†åŒºå¤šå‰¯æœ¬æ¶æ„æ‰æ˜¯å¯ç”¨çš„ã€‚

### 2.2 ç”Ÿäº§è€…æ¶ˆè´¹è€…å¯é æ€§

> ***é¢è¯•å®˜ï¼šè¿˜æœ‰å‘¢ï¼Ÿ***

ä¸Šé¢æ‰€è¯´çš„å…¶å®æ˜¯åŸºäºBrokerå±‚é¢å¸¦ç»™Kafkaçš„å¯é æ€§ä¿éšœï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å±‚é¢ä¸‹åŠŸå¤«ï¼Œæ¥ä½¿æ•´ä¸ªç³»ç»Ÿå‡å°‘ä¸¢å¤±æ•°æ®çš„é£é™©ã€‚

ä¸€ã€åœ¨ç”Ÿäº§è€…æ–¹é¢ã€‚

Kafkaæä¾›äº†å¤šç§**å‘é€ç¡®è®¤æ¨¡å¼**ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„å¯é æ€§éœ€æ±‚é…ç½®åˆé€‚çš„acksã€‚

1. ack = 0ã€‚å¦‚æœæ¶ˆæ¯ç”Ÿäº§è€…èƒ½å¤ŸæŠŠæ¶ˆæ¯é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ï¼Œåˆ™è®¤ä¸ºæ¶ˆæ¯å·²æˆåŠŸå†™å…¥ã€‚
2. ack = 1ã€‚å¦‚æœé¦–é¢†åˆ†åŒºæ”¶åˆ°æ¶ˆæ¯å¹¶æˆåŠŸå†™å…¥ï¼Œç”Ÿäº§è€…æ”¶åˆ°**ç¡®è®¤è¿”å›**ï¼Œåˆ™è®¤ä¸ºæ¶ˆæ¯å·²æˆåŠŸå†™å…¥ã€‚
3. ack = allã€‚åªæœ‰åœ¨æ¶ˆæ¯æˆåŠŸ**å†™å…¥æ‰€æœ‰åˆ†åŒºå‰¯æœ¬**åï¼Œæ‰è®¤ä¸ºæ¶ˆæ¯å·²æˆåŠŸå†™å…¥ã€‚è¿™ä¿è¯äº†æ¶ˆæ¯çš„å¤šå¤‡ä»½ã€‚

ä»¥ä¸Šçš„å„ç§acksæƒ…å†µå¦‚æœå¤±è´¥çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç”Ÿäº§è€…ç»§ç»­**é‡è¯•**å‘é€æ¶ˆæ¯ï¼Œç›´åˆ°Kafkaè¿”å›æˆåŠŸã€‚

äºŒã€åœ¨æ¶ˆè´¹è€…æ–¹é¢

å¤§å®¶å¦‚æœèƒ½å›ç­”ä¸Šæ–‡ç¬¬ä¸€ä¸ªé¢è¯•å®˜é—®é¢˜ï¼š`çŸ¥é“Kafkaé«˜æ°´ä½å—`ï¼Œå°±çŸ¥é“Kafkaé«˜æ°´ä½ä¿è¯äº†æ¶ˆè´¹è€…åªä¼šè¯»å–åˆ°å·²æäº¤çš„æ•°æ®ï¼Œå³è¢«å†™å…¥æ‰€æœ‰åˆ†åŒºå‰¯æœ¬çš„æ•°æ®ã€‚æ‰€ä»¥æ¶ˆè´¹è€…è¦ç¡®ä¿çš„æ˜¯è·Ÿè¸ªå“ªäº›æ•°æ®å·²è¯»å–äº†ã€å“ªäº›æ•°æ®æœªè¯»å–ã€‚

1. æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶ä¼šå…ˆè·å–ä¸€æ‰¹æ¶ˆæ¯ï¼ŒåŒæ—¶ä»æœ€åä¸€ä¸ªåç§»é‡å¼€å§‹è¯»å–ï¼Œè¿™ä¿è¯äº†**æ¶ˆæ¯çš„é¡ºåºæ€§**ã€‚
2. æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯åä¼šåŒæ­¥æäº¤ã€å¼‚æ­¥**æäº¤åç§»é‡**ï¼Œä¿è¯äº†æ¶ˆæ¯ä¸è¢«å…¶ä»–æ¶ˆè´¹è€…**é‡å¤æ¶ˆè´¹**ã€‚

### 2.3 æ¶ˆè´¹å †ç§¯é—®é¢˜

> ***é¢è¯•å®˜ï¼šé‚£è¦æ˜¯Kafkaæ¶ˆè´¹å †ç§¯äº†ä½ æ€ä¹ˆå¤„ç†ï¼Ÿ***

è¿™ä¸ªé—®é¢˜æ˜¯é¢è¯•å®˜å¸¸è€ƒçš„ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¦ä»Brokerå’Œæ¶ˆè´¹è€…ä¸¤æ–¹é¢æ¥çœ‹ã€‚

ä¸€ã€Brokerçš„è¯ã€‚
1. æ¯ä¸ªtopicæ˜¯åˆ†ä¸ºå¤šä¸ªåˆ†åŒºç»™ä¸åŒBrokerè¿›è¡Œå¤„ç†ï¼Œè¦**åˆç†åˆ†é…åˆ†åŒºæ•°é‡**æ¥æé«˜Brokerçš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚æ¯”å¦‚3ä¸ªBroker2ä¸ªåˆ†åŒºï¼Œå¯ä»¥æ”¹ä¸º3ä¸ªBroker3ä¸ªåˆ†åŒºã€‚
2. å¯ä»¥**æ¨ªå‘æ‰©å±•**Brokeré›†ç¾¤ï¼Œæ¥æé«˜Brokerçš„æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚

äºŒã€æ¶ˆè´¹è€…çš„è¯ã€‚
1. å¯ä»¥å¢åŠ æ¶ˆè´¹è€…æœåŠ¡æ•°é‡æ¥æé«˜æ¶ˆæ¯æ¶ˆè´¹èƒ½åŠ›ã€‚
2. åœ¨æäº¤åç§»é‡æ—¶ï¼Œå¯ä»¥æŠŠåŒæ­¥æäº¤æ”¹ä¸º**å¼‚æ­¥æäº¤**ã€‚å¼‚æ­¥æäº¤æ— éœ€ç­‰å¾…Kafkaçš„ç¡®è®¤è¿”å›ï¼Œå‡å°‘äº†åŒæ­¥ç­‰å¾…Brokerçš„æ—¶é—´ã€‚

## 3. Kafkaæ§åˆ¶å™¨

> ***é¢è¯•å®˜ï¼šçŸ¥é“Kafkaæ§åˆ¶å™¨å§ï¼Ÿ***

Kafkaæ§åˆ¶å™¨å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªBrokerï¼Œä¸è¿‡å®ƒè¿˜è´Ÿè´£é€‰ä¸¾**åˆ†åŒºé¦–é¢†**ã€‚Kafkaçš„æ§åˆ¶å™¨å’ŒRedisé›†ç¾¤çš„å“¨å…µçš„é€‰ä¸¾åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚

ä¹Ÿå°±æ˜¯åœ¨é¦–é¢†å‰¯æœ¬æ‰€åœ¨çš„åˆ†åŒºå¤±æ•ˆåï¼ŒKafkaä¼šé€šè¿‡æ§åˆ¶å™¨æ¥åœ¨åˆ†åŒºå‰¯æœ¬é‡Œé€‰ä¸¾å‡ºæ–°çš„**é¦–é¢†å‰¯æœ¬**ã€‚
# ç†Ÿæ‚‰Kafkaç»„æˆæ¨¡å—ã€Kafkaæ¶ˆæ¯æäº¤çš„æ–¹å¼åŠä¼˜ç¼ºç‚¹

## 1. Kafkaæ¦‚å¿µ

### 1.1 Kafkaç»„æˆæ¨¡å—

> ***é¢è¯•å®˜ï¼šä½ å…ˆè¯´è¯´Kafkaç”±ä»€ä¹ˆæ¨¡å—ç»„æˆï¼Ÿ***

Kafkaå…¶å®æ˜¯ä¸€æ¬¾åŸºäº**å‘å¸ƒä¸è®¢é˜…æ¨¡å¼**çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œå¦‚æœæŒ‰å¸¸ç†æ¥è®¾è®¡ï¼Œå¤§å®¶æ˜¯ä¸æ˜¯æŠŠæ¶ˆæ¯å‘é€è€…çš„æ¶ˆæ¯ç›´æ¥å‘é€ç»™æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Ÿä½†Kafkaå¹¶ä¸æ˜¯è¿™ä¹ˆè®¾è®¡çš„ï¼ŒKafkaæ¶ˆæ¯çš„ç”Ÿäº§è€…ä¼šå¯¹æ¶ˆæ¯è¿›è¡Œåˆ†ç±»ï¼Œå†å‘é€ç»™ä¸­é—´çš„æ¶ˆæ¯æœåŠ¡ç³»ç»Ÿï¼Œè€Œæ¶ˆæ¯æ¶ˆè´¹è€…é€šè¿‡è®¢é˜…æŸåˆ†ç±»çš„æ¶ˆæ¯å»æ¥å—ç‰¹å®šç±»å‹çš„æ¶ˆæ¯ã€‚

å…¶å®è¿™ä¹ˆè®¾è®¡çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†æ»¡è¶³å¤§é‡ä¸šåŠ¡æ¶ˆæ¯çš„æ¥å…¥ï¼Œè¦æ˜¯å•ä¸€çš„æ¶ˆæ¯å‘é€å’Œæ¥æ”¶ï¼Œé‚£å¼€ä¸ªè¿›ç¨‹çš„**ç®¡é“é€šä¿¡**å°±å¯ä»¥äº†ã€‚å¦å¤–å¦‚æœå¤§å®¶å¯¹è®¾è®¡æ¨¡å¼çš„**å‘å¸ƒ/è®¢é˜…æ¨¡å¼**ç†Ÿæ‚‰çš„è¯ï¼Œå¯¹Kafkaçš„è®¾è®¡ç†å¿µä¼šæ›´å®¹æ˜“ç†è§£ã€‚

æ€»çš„æ¥è¯´ï¼ŒKafkaç”±äº”å¤§æ¨¡å—ç»„æˆï¼Œå¤§å®¶è¦ç†è§£å¥½è¿™äº›æ¨¡å—çš„åŠŸèƒ½ä½œç”¨ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ã€æ¶ˆæ¯æ¶ˆè´¹è€…ã€`Broker`ã€ä¸»é¢˜`Topic`ã€åˆ†åŒº`Partition`ã€‚

ï¼ˆ1ï¼‰æ¶ˆæ¯ç”Ÿäº§è€…

æ¶ˆæ¯ç”Ÿäº§è€…æ˜¯æ¶ˆæ¯çš„åˆ›é€ è€…ï¼Œæ¯å‘é€ä¸€æ¡æ¶ˆæ¯éƒ½ä¼šå‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ä¸Šå»ã€‚

ï¼ˆ2ï¼‰æ¶ˆæ¯æ¶ˆè´¹è€…

æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½æ˜¯Kafkaçš„å®¢æˆ·ç«¯ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…é¡¾åæ€ä¹‰ä½œä¸ºæ¶ˆæ¯çš„è¯»å–è€…ã€æ¶ˆè´¹è€…ã€‚åŒæ—¶Kafkaå¾ˆçµæ´»çš„ä¸€ç‚¹æ˜¯ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…å¤šä¸ªä¸»é¢˜ï¼Œè€Œä¸”ä¸€ä¸ªä¸»é¢˜æ¶ˆæ¯ä¹Ÿå¯è¢«ä¸åŒæ¶ˆæ¯åˆ†ç»„çš„å¤šä¸ªæ¶ˆè´¹è€…å¤„ç†ã€‚è¿™å°±ç»™æˆ‘ä»¬å˜åŒ–å¤šç«¯çš„ä¸šåŠ¡è®¾è®¡å¸¦æ¥äº†ä¼—å¤šå¯èƒ½æ€§äº†ï¼Œæ–¹ä¾¿å¤§å®¶è‡ªç”±å‘æŒ¥ã€‚

ï¼ˆ3ï¼‰`Broker`

å­¤é›¶é›¶éƒ¨ç½²åœ¨Linuxçš„KafkaæœåŠ¡å™¨è¢«ç§°ä¸º`Broker`ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä¸Šæ–‡æåˆ°çš„`ä¸­é—´çš„æ¶ˆæ¯æœåŠ¡ç³»ç»Ÿ`ï¼Œå¤§å®¶ä¸è¦å°ç§ä»–ï¼Œå•å°Brokerå¯ä»¥è½»æ¾å¤„ç†**æ¯ç§’ç™¾ä¸‡çº§**çš„æ¶ˆæ¯é‡ã€‚Brokeræ—¥å¸¸å·¥ä½œå†…å®¹å°±æ˜¯æ¥æ”¶æ¶ˆæ¯ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œä¸ºæ¯æ¡æ¶ˆæ¯è®¾ç½®åç§»é‡ï¼Œæœ€åæäº¤åˆ°ç£ç›˜è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜ã€‚

ï¼ˆ4ï¼‰ä¸»é¢˜`Topic`

ä¸Šæ–‡æˆ‘ä»¬çŸ¥é“Kafkaçš„æ¶ˆæ¯æ˜¯æœ‰åˆ†ç±»çš„ï¼Œè€Œåˆ†ç±»çš„æ ‡è¯†å°±æ˜¯ä¸»é¢˜`Topic`ã€‚å¤§å®¶å¯ä»¥çœ‹ä¸‹å…·ä½“ä»£ç è½åœ°ä¼šæ›´å®¹æ˜“ç†è§£ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…`Producer`å‘é€ç»™`clock-topic`ä¸»é¢˜ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…ç›‘å¬æ¶ˆè´¹`clock-topic`ä¸»é¢˜ä¸‹çš„æ¶ˆæ¯ã€‚

```java
// æ¶ˆæ¯ç”Ÿäº§è€…
public class Producer implements ApplicationRunner {
    @Resource
    private RedissonClient redissonClient;
    @Resource
    private KafkaTemplate<String, String> kafkaTemplate;
    
    @Override
    public void run(ApplicationArguments args) throws Exception {
        RBlockingQueue<Clock> blockingFairQueue = redissonClient.getBlockingQueue("delay_queue");

        while (true) {
            Clock clock = blockingFairQueue.take();
            kafkaTemplate.send("clock-topic", "key", clock.toString());
            log.info("time out: {} , clock created: {}", new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date()), clock.getTime());
        }
    }
}
```

```java
    // æ¶ˆæ¯æ¶ˆè´¹è€…
    @KafkaListener(topics = "clock-topic", groupId = "kafka-group")
    public void listener(ConsumerRecord<String, String> record, Acknowledgment ack) {
        log.info("listener get message: " + record.value());
        ack.acknowledge();
    }

```

ï¼ˆ5ï¼‰åˆ†åŒº`Partition`

æ¯ä¸€ä¸ªä¸»é¢˜ä¸‹çš„æ¶ˆæ¯éƒ½éœ€è¦æäº¤åˆ°Brokerçš„ç£ç›˜é‡Œï¼Œå‡å¦‚æˆ‘ä»¬æ­å»ºäº†ä¸‰ä¸ªBrokerèŠ‚ç‚¹ç»„æˆçš„Kafkaé›†ç¾¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹åŒä¸€ä¸ªä¸»é¢˜ä¸‹çš„æ¶ˆæ¯ä¼šè¢«åˆ†åˆ°ä¸‰ä¸ªåˆ†åŒºè¿›è¡Œå­˜å‚¨ã€‚è¯´åˆ°è¿™ï¼Œç”±äºé¡ºåºå‘é€çš„æ¶ˆæ¯æ˜¯å­˜å‚¨åœ¨ä¸åŒåˆ†åŒºä¸­ï¼Œæˆ‘ä»¬æ— æ³•ä¿è¯æ¶ˆæ¯è¢«æŒ‰**é¡ºåºæ¶ˆè´¹**ï¼Œåªèƒ½ä¿è¯**åŒä¸€ä¸ªåˆ†åŒº**ä¸‹çš„æ¶ˆæ¯è¢«é¡ºåºæ¶ˆè´¹.

### 1.2 åˆ†åŒº

> ***é¢è¯•å®˜ï¼šé‚£åˆ†åŒºæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ***

æ¶ˆè´¹åˆ†åŒºçš„ä½œç”¨ä¸»è¦å°±æ˜¯ä¸ºäº†æé«˜Kafkaå¤„ç†æ¶ˆæ¯çš„**ååé‡**ï¼Œè°å«Kafkaè®¾è®¡ä¹‹åˆå°±æ˜¯ä½œä¸ºä¸€æ¬¾é«˜ååé‡ã€é«˜å¯ç”¨ã€å¯æ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚

å‡å¦‚ä¸€ä¸ªtopicä¸‹æœ‰Nä¸ªåˆ†åŒºã€Nä¸ªæ¶ˆè´¹è€…ï¼Œæ¯ä¸ªåˆ†åŒºä¼šå‘é€æ¶ˆæ¯ç»™å¯¹åº”çš„ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¿™æ ·Nä¸ªæ¶ˆè´¹è€…å°±å¯ä»¥**è´Ÿè½½å‡è¡¡**åœ°å¤„ç†æ¶ˆæ¯ã€‚

åŒæ—¶æ¶ˆæ¯ç”Ÿäº§è€…ä¼šå‘é€æ¶ˆæ¯ç»™ä¸åŒåˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåˆæ˜¯å±äºä¸åŒçš„Brokerï¼Œè¿™è®©Brokeré›†ç¾¤**å¹³å¦å‹åŠ›**ï¼Œå¤§å¤§æé«˜äº†Kafkaçš„ååé‡ã€‚

å¤§å®¶è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¦‚æœä¸€ä¸ªä¸»é¢˜ä¸‹æ¶ˆè´¹è€…çš„æ•°é‡è¶…è¿‡åˆ†åŒºçš„æ•°é‡ï¼Œè¶…è¿‡æ•°é‡çš„æ¶ˆè´¹è€…æ˜¯ä¼šè¢«**é—²ç½®**çš„ï¼Œä¸€èˆ¬Nä¸ªåˆ†åŒºæœ€å¤šæ­é…Nä¸ªæ¶ˆè´¹è€…ã€‚

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/d5253c915efc4a50aa13696321c77edc.png#pic_center)

### 1.3 å¼‚æ­¥å›è°ƒ

> ***é¢è¯•å®˜ï¼šæ¶ˆæ¯ç”Ÿäº§è€…çš„å¼‚æ­¥å›è°ƒï¼ŒçŸ¥é“å§ï¼Ÿ***

å½“æˆ‘ä»¬è°ƒç”¨send()å¼‚æ­¥å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šç­‰BrokeræœåŠ¡å™¨å“åº”æ—¶è§¦å‘ã€‚å¦‚ä¸‹æºç æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå“åº”å‚æ•°`ListenableFuture`æ·»åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°å®ç°`callback`ã€‚

```java
    public ListenableFuture<SendResult<K, V>> send(String topic, K key, @Nullable V data) {
        ProducerRecord<K, V> producerRecord = new ProducerRecord(topic, key, data);
        return this.doSend(producerRecord);
    }

    public interface ListenableFuture<T> extends Future<T> {
       void addCallback(ListenableFutureCallback<? super T> callback);
    }
```

é‚£è¿™ä¸ªå›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿæˆ‘ä»¬ä¸€èˆ¬ç”¨æ¥è¿›è¡Œ**å¼‚å¸¸æ—¥å¿—çš„è®°å½•**ã€‚

Kafkaçš„**å¼‚æ­¥æäº¤æ¶ˆæ¯**ç›¸æ¯”åŒæ­¥æäº¤æ¥è¯´ä¸éœ€è¦åœ¨Brokerå“åº”å‰é˜»å¡çº¿ç¨‹ï¼Œè¿™ä¹Ÿåœ¨ä¸€å®šç¨‹åº¦æé«˜äº†æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ã€‚ä½†å¼‚æ­¥æäº¤æˆ‘ä»¬æ˜¯ä¸çŸ¥é“æ¶ˆæ¯çš„æ¶ˆè´¹æƒ…å†µçš„ï¼Œæ­¤æ—¶å°±å¯ä»¥é€šè¿‡Kafkaæä¾›çš„å›è°ƒå‡½æ•°æ¥å‘ŠçŸ¥ç¨‹åº**å¼‚å¸¸æƒ…å†µ**ï¼Œä»è€Œæ–¹ä¾¿ç¨‹åºè¿›è¡Œæ—¥å¿—è®°å½•ã€‚

## 2. æ¶ˆè´¹è€…æ¶ˆæ¯æäº¤

### 2.1 æäº¤æ¶ˆæ¯çš„æ–¹å¼

> ***é¢è¯•å®˜ï¼šä½ è¯´è¯´æ¶ˆè´¹è€…æ‰‹åŠ¨æäº¤å’Œè‡ªåŠ¨æäº¤æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ***

æ‰‹åŠ¨æäº¤å’Œè‡ªåŠ¨æäº¤æ˜¯Kafkaä¸¤ç§å®¢æˆ·ç«¯çš„åç§»é‡æäº¤æ–¹å¼ï¼Œæäº¤æ–¹å¼çš„é…ç½®é€‰é¡¹æ˜¯`enable.auto.commit`ï¼Œé»˜è®¤æƒ…å†µä¸‹è¯¥é€‰é¡¹ä¸ºtureã€‚

åç§»é‡æäº¤æ˜¯ä»€ä¹ˆï¼Ÿå¤§å®¶å¯ä»¥ç†è§£ä¸ºæ¶ˆè´¹è€…é€šçŸ¥å½“å‰æœ€æ–°çš„**è¯»å–ä½ç½®**ç»™åˆ°åˆ†åŒºï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰åˆ†åŒºå“ªäº›æ¶ˆæ¯å·²æ¶ˆè´¹äº†ã€‚

å¦‚æœ`enable.auto.commit`ä¸ºtrueä»£è¡¨æäº¤æ–¹å¼ä¸ºè‡ªåŠ¨æäº¤ï¼Œé»˜è®¤ä¸º5ç§’çš„æäº¤æ—¶é—´é—´éš”ã€‚æ¯è¿‡**5ç§’**ï¼Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯å°±ä¼šè‡ªåŠ¨æäº¤æœ€å¤§åç§»é‡ã€‚

å¦‚æœ`enable.auto.commit`ä¸ºfalseä»£è¡¨æäº¤æ–¹å¼ä¸ºæ‰‹åŠ¨æäº¤ï¼Œæˆ‘ä»¬éœ€è¦è®©æ¶ˆè´¹è€…å®¢æˆ·ç«¯æ¶ˆè´¹**ç¨‹åºæ‰§è¡Œå**æäº¤å½“å‰çš„æœ€å¤§åç§»é‡ã€‚

### 2.2 æäº¤æ–¹å¼çš„ä¼˜ç¼ºç‚¹

> ***é¢è¯•å®˜ï¼šé‚£å®ƒä»¬éƒ½æœ‰ä»€ä¹ˆä¼˜ã€ç¼ºç‚¹ï¼Ÿ***

ï¼ˆ1ï¼‰è‡ªåŠ¨æäº¤

è‡ªåŠ¨æäº¤æ¯”è¾ƒæ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”šè‡³éƒ½ä¸éœ€è¦é…ç½®æäº¤æ–¹å¼ï¼Œä¸è¿‡å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤æ¶ˆè´¹ã€‚

å¦‚æœåˆšå¥½åˆ°äº†5ç§’çš„æ—¶é—´é—´éš”è‡ªåŠ¨**æäº¤äº†**æœ€å¤§åç§»é‡ï¼Œæ­¤æ—¶æ­£åœ¨æ‰§è¡Œæ¶ˆæ¯ç¨‹åºçš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯å´©æºƒäº†ï¼Œå°±ä¼šå¯¼è‡´**æ¶ˆæ¯ä¸¢å¤±**ã€‚

å¦‚æœæˆåŠŸæ¶ˆè´¹äº†æ¶ˆæ¯ï¼Œä¸‹ä¸€ç§’æ¶ˆè´¹è€…åº”è¯¥è‡ªåŠ¨æäº¤ï¼Œä½†å¦‚æœæ­¤æ—¶æ¶ˆè´¹è€…å®¢æˆ·ç«¯å¥”æºƒï¼Œå°±ä¼šå¯¼è‡´å…¶ä»–åˆ†åŒºçš„æ¶ˆè´¹è€…**é‡å¤æ¶ˆè´¹**ã€‚

ï¼ˆ1ï¼‰æ‰‹åŠ¨æäº¤

æ‰‹åŠ¨æäº¤éœ€è¦æ¶ˆè´¹è€…å®¢æˆ·ç«¯åœ¨æ¶ˆè´¹æ¶ˆæ¯åæ‰‹åŠ¨æäº¤æ¶ˆæ¯ï¼Œæ‰‹åŠ¨æäº¤çš„æ–¹å¼åˆåˆ†ä¸ºåŒæ­¥æäº¤ã€å¼‚æ­¥æäº¤ã€‚

æ‰‹åŠ¨æäº¤æ˜¯**åŒæ­¥æäº¤**çš„è¯ï¼Œåœ¨Brokerå¯¹è¯·æ±‚åšå‡ºå›åº”ä¹‹å‰ï¼Œå®¢æˆ·ç«¯ä¼šä¸€ç›´é˜»å¡ï¼Œè¿™æ ·çš„è¯é™åˆ¶åº”ç”¨ç¨‹åºçš„**ååé‡**ã€‚

æ‰‹åŠ¨æäº¤æ˜¯**å¼‚æ­¥æäº¤**çš„è¯ï¼Œä¸ä¼šæœ‰ååé‡çš„é—®é¢˜ã€‚ä¸è¿‡æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘é€ç»™Brokeråç§»é‡ä¹‹åï¼Œ**ä¸ä¼šç®¡**Brokeræœ‰æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ã€‚è¿™ç§æƒ…å†µå°±è¦é‡‡ç”¨ä¸Šæ–‡æˆ‘æåˆ°çš„æ¶ˆæ¯ç”Ÿäº§è€…**å¼‚æ­¥å›è°ƒ**æ¥è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œæœ‰äº†æ—¥å¿—è®°å½•æ–¹ä¾¿åç»­bugæ’æŸ¥ï¼Œå·¥ä½œæ•ˆç‡å¦¥å¦¥çš„é«˜ğŸ˜ã€‚
