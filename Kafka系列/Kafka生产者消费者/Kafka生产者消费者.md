## 1. Kafka组成模块

> ***面试官：你先说说Kafka由什么模块组成吧？***

嗯嗯好的。

主要有：生产者、消费者、Brocker、Topic、消息分区**Partition**。

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.1 生产者、消费者

> ***面试官：那我们先讲讲生产者、消费者？***

嗯嗯好的。

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.2 异步回调

> ***面试官：消息生产者的异步回调，知道吧？***

Ok知道的。主要是可以进行**异常日志的记录**。

是这样的，Kafka的**异步提交消息**相比同步提交，不需要在brocker响应前阻塞线程。

但是异步提交我们是不知道消费情况的，所以就可以在Kafka消费异常时，通过其**回调**来告知程序**异常情况**，从而进行日志记录。

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 1.3 消费者分区

> ***面试官：消费者分区呢？***

嗯嗯。分区的作用主要就是为了提高Kafka处理消息**吞吐量**。

每一个topic会被**分为多个分区**。

假如同一个topic下有n个分区、n个消费者，**每个**分区会发送消息给对应的**一个**消费者，这样**n个消费者就可以负载均衡**地处理消息。

同时**生产者**会发送消息给不同分区，每个分区**分给不同的brocker**处理，让集群平坦压力，这样大大提高了Kafka的吞吐量。

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/bb6d32040cfe437c9e2cf6f5dbf8e0ac.png#pic_center)

> <br/>
>
> *面试官思考中…*
>
> <br/>

## 2. 消费者手动提交和自动提交

> ***面试官：你说说消费者手动提交和自动提交，有什么区别？***

其实就是两种不同的客户端提交方式。

1. 自动提交的话，通过设置enable.auto.commit为true，**每过5秒**消费者客户端就会自动提交最大偏移量
2. 手动提交的话，通过设置enable.auto.commit为false，让消费者客户端消费**程序执行后**提交当前的偏移量

> <br/>
>
> *面试官思考中…*
>
> <br/>

### 2.1 两种提交的优缺点

> ***面试官：那它们都有什么优、缺点？***

1. 自动提交的话，比较方便**只需要配置**就可以，不过可能会导致消息丢失或重复消费。
   - 如果刚好到了5秒时**提交了**最大偏移量，此时正在消费中的消费者客户端崩溃了，就会导致**消息丢失**
   - 如果成功消费了，下一秒应该自动提交，但此时消费者客户端奔溃了**提交不了**，就会导致其他分区的消费者**重复消费**
2. 手动提交的话，需要**写程序**手动提交，要分两种提交方式。
   - 手动提交是**同步提交**的话，在broker对请求做出回应之前，客户端会一直阻塞，这样的话限制应用程序的**吞吐量**
   - 是**异步提交**的话，不会有吞吐量的问题。不过发送给broker偏移量之后，**不会管**broker有没有收到消息

![在这里插入图片描述](https://img-blog.csdnimg.cn/direct/8239593605f340a3bcb8fc2b3aee4503.png#pic_center)

> *面试官抓抓脑袋，继续看你的简历......*
>
> <br/>
>
> *得想想考点你不懂的😰*

## 未完待续。。。
